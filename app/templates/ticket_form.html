{% extends "base.html" %}

{% block content %}
<h2>
  {% if ticket %}
    Editar Ticket
  {% else %}
    Crear Ticket
  {% endif %}
</h2>

<form method="POST">

  <!-- TÍTULO -->
  <label>Título</label>
  <input type="text" name="title" required
         value="{{ ticket.title if ticket else '' }}">

  <!-- DESCRIPCIÓN -->
  <label>Descripción</label>
  <textarea name="description" required>{{ ticket.description if ticket else '' }}</textarea>

  <!-- FECHA Y HORA -->
  <label>Fecha y hora</label>
  <input type="datetime-local" name="created_at"
         value="{{ ticket.created_at.strftime('%Y-%m-%dT%H:%M') if ticket and ticket.created_at else '' }}">

  <!-- ESTADO -->
  <label>Estado</label>
  <select name="status" required>
    {% set estados = ['Nuevo', 'Abierto', 'En Proceso', 'En Espera', 'Cerrado'] %}
    {% for estado in estados %}
      <option value="{{ estado }}"
        {% if ticket and ticket.status == estado %}selected{% endif %}>
        {{ estado }}
      </option>
    {% endfor %}
  </select>

  <!-- PRIORIDAD -->
  <label>Prioridad</label>
  <select name="priority" required>
    {% set prioridades = ['Baja', 'Media', 'Alta', 'Crítica'] %}
    {% for p in prioridades %}
      <option value="{{ p }}"
        {% if ticket and ticket.priority == p %}selected{% endif %}>
        {{ p }}
      </option>
    {% endfor %}
  </select>

  <!-- FUENTE (NO PUNTITOS) -->
  <label>Fuente del ticket</label>
  <select name="source" required>
    {% set fuentes = ['Correo', 'Teléfono', 'Presencial', 'Sistema'] %}
    {% for f in fuentes %}
      <option value="{{ f }}"
        {% if ticket and ticket.source == f %}selected{% endif %}>
        {{ f }}
      </option>
    {% endfor %}
  </select>

  <!-- TÉCNICO -->
  <label>Técnico a cargo</label>
  <input type="text" name="technician"
         value="{{ ticket.technician if ticket else '' }}">

  <!-- MEDIDAS ADOPTADAS -->
  <label>Medidas adoptadas</label>
  <textarea name="actions_taken">{{ ticket.actions_taken if ticket else '' }}</textarea>

  <!-- RESOLUCIÓN -->
  <label>Resolución</label>
  <textarea name="resolution">{{ ticket.resolution if ticket else '' }}</textarea>

  <br><br>

  <button type="submit">
    {% if ticket %}Guardar cambios{% else %}Crear ticket{% endif %}
  </button>

  <a href="{{ url_for('ticket.list_tickets') }}">
    <button type="button">⬅ Volver</button>
  </a>

</form>
{% endblock %}
