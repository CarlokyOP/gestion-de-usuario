{% extends "base.html" %}

{% block content %}
<div class="container">

    <h1>{{ 'Editar Ticket' if ticket else 'Nuevo Ticket' }}</h1>

    <form method="POST">

        <label>Título</label>
        <input type="text" name="titulo" required
               value="{{ ticket.titulo if ticket else '' }}">

        <label>Descripción</label>
        <textarea name="descripcion" required>{{ ticket.descripcion if ticket else '' }}</textarea>

        <!-- FECHA Y HORA (SEPARADAS) -->
        <label>Fecha y hora</label>
        <div style="display:flex; gap:10px;">
            <input type="date" name="fecha"
                   value="{% if ticket %}{{ ticket.fecha_creacion.strftime('%Y-%m-%d') }}{% endif %}">
            <input type="time" name="hora"
                   value="{% if ticket %}{{ ticket.fecha_creacion.strftime('%H:%M') }}{% endif %}">
        </div>

        <label>Estado</label>
        <select name="estado" required>
            {% for e in ['Nuevo','Apertura','Resuelto','Cierre','Escalado'] %}
                <option value="{{ e }}"
                    {% if ticket and ticket.estado == e %}selected{% endif %}>
                    {{ e }}
                </option>
            {% endfor %}
        </select>

        <label>Prioridad</label>
        <select name="prioridad" required>
            {% for p in ['Baja','Media','Alta'] %}
                <option value="{{ p }}"
                    {% if ticket and ticket.prioridad == p %}selected{% endif %}>
                    {{ p }}
                </option>
            {% endfor %}
        </select>

        <label>Nombre del cliente</label>
        <input type="text" name="nombre_cliente" required
               value="{{ ticket.nombre_cliente if ticket else '' }}">

        <label>Teléfono</label>
        <input type="text" name="telefono_cliente" required
               value="{{ ticket.telefono_cliente if ticket else '' }}">

        <label>Correo electrónico</label>
        <input type="email" name="correo_cliente" required
               value="{{ ticket.correo_cliente if ticket else '' }}">

        <label>Tipo de problema</label>
        <select name="tipo_problema" required>
            {% for t in ['Hardware','Movil','Red','Otro'] %}
                <option value="{{ t }}"
                    {% if ticket and ticket.tipo_problema == t %}selected{% endif %}>
                    {{ t }}
                </option>
            {% endfor %}
        </select>

        <!-- FUENTE DEL TICKET (CHECKBOXES COMO LA IMAGEN) -->
        <label>Fuente del ticket</label>
        <div style="display:flex; gap:25px; margin-bottom:20px;">
            {% for f in ['Llamada telefónica','Correo electrónico','WebChat','Presencial'] %}
                <label style="display:flex; align-items:center; gap:6px;">
                    <input type="checkbox" name="fuente_ticket"
                           value="{{ f }}"
                           {% if ticket and ticket.fuente_ticket == f %}checked{% endif %}>
                    {{ f }}
                </label>
            {% endfor %}
        </div>

        <div style="margin-top:25px;">
            <button type="submit" class="btn btn-primary">
                {{ 'Guardar cambios' if ticket else 'Crear ticket' }}
            </button>

            <a href="{{ url_for('ticket.list_tickets') }}"
               class="btn btn-secondary">
                ← Volver al listado
            </a>
        </div>

    </form>
</div>
{% endblock %}
