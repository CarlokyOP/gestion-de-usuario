{% extends "base.html" %}
{% block content %}

<h2>{{ "Editar Ticket" if ticket else "Nuevo Ticket" }}</h2>

<form method="POST">

    <label>Título</label>
    <input type="text" name="titulo" value="{{ ticket.titulo if ticket else '' }}" required>

    <label>Descripción</label>
    <textarea name="descripcion" required>{{ ticket.descripcion if ticket else '' }}</textarea>

    <label>Fecha y hora</label>
    <div style="display:flex; gap:10px;">
        <input type="date" name="fecha"
               value="{{ ticket.fecha_creacion.strftime('%Y-%m-%d') if ticket else '' }}">
        <input type="time" name="hora"
               value="{{ ticket.fecha_creacion.strftime('%H:%M') if ticket else '' }}">
    </div>

    <label>Estado</label>
    <select name="estado">
        {% for e in ["Nuevo","Apertura","Resuelto","Cierre","Escalada"] %}
        <option value="{{ e }}" {{ "selected" if ticket and ticket.estado == e else "" }}>
            {{ e }}
        </option>
        {% endfor %}
    </select>

    <label>Prioridad</label>
    <select name="prioridad">
        {% for p in ["Baja","Media","Alta"] %}
        <option value="{{ p }}" {{ "selected" if ticket and ticket.prioridad == p else "" }}>
            {{ p }}
        </option>
        {% endfor %}
    </select>

    <label>Nombre del cliente</label>
    <input type="text" name="nombre_cliente" value="{{ ticket.nombre_cliente if ticket else '' }}" required>

    <label>Teléfono</label>
    <input type="text" name="telefono_cliente" value="{{ ticket.telefono_cliente if ticket else '' }}" required>

    <label>Correo</label>
    <input type="email" name="correo_cliente" value="{{ ticket.correo_cliente if ticket else '' }}" required>

    <label>Tipo de problema</label>
    <select name="tipo_problema">
        {% for t in ["Hardware","Movil","Red","Otro"] %}
        <option value="{{ t }}" {{ "selected" if ticket and ticket.tipo_problema == t else "" }}>
            {{ t }}
        </option>
        {% endfor %}
    </select>

    <label>Fuente del ticket</label>
    <select name="fuente_ticket">
        {% for f in ["Llamada","Correo","WebChat","Presencial"] %}
        <option value="{{ f }}" {{ "selected" if ticket and ticket.fuente_ticket == f else "" }}>
            {{ f }}
        </option>
        {% endfor %}
    </select>

    <br><br>
    <button type="submit" class="btn btn-primary">
        {{ "Guardar cambios" if ticket else "Crear ticket" }}
    </button>

    <a href="{{ url_for('ticket_bp.list_tickets') }}" class="btn btn-secondary">
        ← Volver al listado
    </a>

</form>

{% endblock %}
