{% extends "base.html" %}

{% block content %}
<div class="container">

  <div class="header-row">
    <h1>Listado de Tickets</h1>
    <a href="{{ url_for('ticket.create_ticket') }}" class="btn btn-primary">
      + Crear ticket
    </a>
  </div>

  {% if tickets %}
    {% for t in tickets %}
      <div class="ticket-card
        {% if t.prioridad == 'Alta' %}ticket-alta
        {% elif t.prioridad == 'Media' %}ticket-media
        {% else %}ticket-baja
        {% endif %}
      ">

        <div class="ticket-title">
          {{ t.titulo }}
        </div>

        <div class="ticket-meta">
          <span><strong>Estado:</strong> {{ t.estado }}</span>
          <span><strong>Prioridad:</strong> {{ t.prioridad }}</span>
          <span><strong>Cliente:</strong> {{ t.nombre_cliente }}</span>
          <span>
            <strong>Fecha:</strong>
            {{ t.fecha_creacion.strftime("%d-%m-%Y %H:%M") }}
          </span>
        </div>

        <div class="ticket-actions">
          <a
            href="{{ url_for('ticket.ticket_detail', ticket_id=t.id) }}"
            class="btn btn-view"
          >
            Ver
          </a>

          <a
            href="{{ url_for('ticket.edit_ticket', ticket_id=t.id) }}"
            class="btn btn-edit"
          >
            Editar
          </a>
        </div>

      </div>
    {% endfor %}
  {% else %}
    <p>No hay tickets creados.</p>
  {% endif %}

</div>

<!-- ðŸ”„ AUTO REFRESH -->
<script>
  // Recarga automÃ¡tica cada 10 segundos
  setInterval(() => {
    window.location.reload();
  }, 10000);
</script>

{% endblock %}
